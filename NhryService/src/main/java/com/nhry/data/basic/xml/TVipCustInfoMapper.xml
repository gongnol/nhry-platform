<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.nhry.data.basic.dao.TVipCustInfoMapper">
	<resultMap id="BaseResultMap" type="com.nhry.data.basic.domain.TVipCustInfo">
		<id column="VIP_CUST_NO" property="vipCustNo" jdbcType="VARCHAR" />
		<result column="VIP_CUST_NO_SAP" property="vipCustNoSap" jdbcType="VARCHAR" />
		<result column="SALES_ORG" property="salesOrg" jdbcType="VARCHAR" />
		<result column="VIP_NAME" property="vipName" jdbcType="VARCHAR" />
		<result column="ACCT_AMT" property="acctAmt" jdbcType="DECIMAL" />
		<result column="ADDRESS_TXT" property="addressTxt" jdbcType="VARCHAR" />
		<result column="COUNTRY" property="country" jdbcType="VARCHAR" />
		<result column="PROVINCE" property="province" jdbcType="VARCHAR" />
		<result column="CITY" property="city" jdbcType="VARCHAR" />
		<result column="COUNTY" property="county" jdbcType="VARCHAR" />
		<result column="STREET" property="street" jdbcType="VARCHAR" />
		<result column="ROAD" property="road" jdbcType="VARCHAR" />
		<result column="SUBDIST" property="subdist" jdbcType="VARCHAR" />
		<result column="SUBDIST_NAME" property="subdistName" jdbcType="VARCHAR" />
		<result column="ROOM" property="room" jdbcType="VARCHAR" />
		<result column="MP" property="mp" jdbcType="VARCHAR" />
		<result column="TEL" property="tel" jdbcType="VARCHAR" />
		<result column="ZIP" property="zip" jdbcType="VARCHAR" />
		<result column="Email" property="email" jdbcType="VARCHAR" />
		<result column="ALIPAY_ACCOUNT" property="alipayAccount" jdbcType="VARCHAR" />
		<result column="WEBCHAT_NO" property="webchatNo" jdbcType="VARCHAR" />
		<result column="NH_EC_ACCOUNT" property="nhEcAccount" jdbcType="VARCHAR" />
		<result column="JD_ACCOUNT" property="jdAccount" jdbcType="VARCHAR" />
		<result column="SEX" property="sex" jdbcType="VARCHAR" />
		<result column="BIRTHDAY" property="birthday" jdbcType="DATE" />
		<result column="CERT_ID" property="certId" jdbcType="VARCHAR" />
		<result column="VIP_SRC" property="vipSrc" jdbcType="VARCHAR" />
		<result column="MILKBOX" property="milkbox" jdbcType="VARCHAR" />
		<result column="VIP_TYPE" property="vipType" jdbcType="VARCHAR" />
		<result column="SUBSCRIBE_DATE" property="subscribeDate" jdbcType="DATE" />
		<result column="SUBSCRIBER" property="subscriber" jdbcType="VARCHAR" />
		<result column="ACTIVITY_NO" property="activityNo" jdbcType="VARCHAR" />
		<result column="STATUS" property="status" jdbcType="VARCHAR" />
		<result column="VIP_AMT" property="vipAmt" jdbcType="DECIMAL" />
		<result column="CREATE_AT" property="createAt" jdbcType="TIMESTAMP" />
		<result column="CREATE_BY" property="createBy" jdbcType="VARCHAR" />
		<result column="CREATE_BY_TXT" property="createByTxt" jdbcType="VARCHAR" />
		<result column="LAST_MODIFIED" property="lastModified" jdbcType="TIMESTAMP" />
		<result column="LAST_MODIFIED_BY" property="lastModifiedBy" jdbcType="VARCHAR" />
		<result column="LAST_MODIFIED_BY_TXT" property="lastModifiedByTxt" jdbcType="VARCHAR" />
		<result column="MEMO_TXT" property="memoTxt" jdbcType="VARCHAR" />
		<result column="DISP_MEMO_TXT" property="dispMemoTxt" jdbcType="VARCHAR" />
		<result column="BRANCH_NO" property="branchNo" jdbcType="VARCHAR" />
		<result column="FIRST_ORDER_TIME" property="firstOrderTime" jdbcType="TIMESTAMP" />
		<result column="LAST_ORDER_TIME" property="lastOrderTime" jdbcType="TIMESTAMP" />
		<result column="BRANCH_NAME" property="branchName" jdbcType="VARCHAR" />
		<result column="DEALER_NO" property="dealerNo" jdbcType="VARCHAR" />
		<result column="DEALER_NAME" property="dealerName" jdbcType="VARCHAR" />
		<result column="VIP_SRC_NAME" property="vipSrcName" jdbcType="VARCHAR" />
		<result column="VIP_TYPE_NAME" property="vipTypeName" jdbcType="VARCHAR" />
		<result column="VIP_MP" property="vipMp" jdbcType="VARCHAR"/>
		<result column="ORG_ID" property="orgId" jdbcType="VARCHAR"/>
		<result column="ORG_NAME" property="orgName" jdbcType="VARCHAR"/>
	</resultMap>
	<sql id="Base_Column_List">
		VIP_CUST_NO, VIP_CUST_NO_SAP, SALES_ORG, VIP_NAME,
		ADDRESS_TXT, COUNTRY, PROVINCE,
		CITY, COUNTY, STREET, ROAD, SUBDIST,
		ROOM, MP, TEL, ZIP, Email,
		ALIPAY_ACCOUNT, WEBCHAT_NO,
		NH_EC_ACCOUNT,
		JD_ACCOUNT, SEX, BIRTHDAY, CERT_ID, VIP_SRC, MILKBOX, VIP_TYPE,
		SUBSCRIBE_DATE,
		SUBSCRIBER, ACTIVITY_NO, STATUS, VIP_AMT, CREATE_AT,
		CREATE_BY, CREATE_BY_TXT,
		LAST_MODIFIED,
		LAST_MODIFIED_BY,DEALER_NO,
		LAST_MODIFIED_BY_TXT, MEMO_TXT, DISP_MEMO_TXT, BRANCH_NO,VIP_MP,
		date_format(FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,date_format(LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME
	</sql>
	<select id="findVipCustByNo" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT
		i.VIP_CUST_NO,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.SALES_ORG_CONSTANT" /> AND 
		it.ITEM_CODE = i.SALES_ORG
		) SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.PROVINCE
		) PROVINCE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.CITY
		) CITY,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.COUNTY
		) COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		i.BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_src" /> AND 
		it.ITEM_CODE = i.VIP_SRC
		) VIP_SRC_NAME,
		i.MILKBOX,
		i.VIP_TYPE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_type" /> AND 
		it.ITEM_CODE = i.VIP_TYPE
		) VIP_TYPE_NAME,
		i.SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.CREATE_AT,
		i.CREATE_BY,
		i.CREATE_BY_TXT,
		i.LAST_MODIFIED,
		i.LAST_MODIFIED_BY,
		i.LAST_MODIFIED_BY_TXT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		(
		 SELECT
				b.BRANCH_NAME
			FROM
				t_md_branch b where b.BRANCH_NO = i.BRANCH_NO
		) BRANCH_NAME,i.BRANCH_NO,i.DEALER_NO,(CASE i.DEALER_NO
			WHEN '-1' THEN '<include refid="mybaties.constant.ownBranch"></include>'
			ELSE (SELECT d.dealer_name from t_md_dealer d where d.dealer_no=i.DEALER_NO) END) DEALER_NAME,
		date_format(FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,date_format(LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME 
		FROM
		t_vip_cust_info i WHERE i.VIP_CUST_NO =#{vipCustNo,jdbcType=VARCHAR}
	</select>
	<select id="findVipCustByNoForUpt" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT
		i.VIP_CUST_NO_SAP,
		i.VIP_CUST_NO,
		i.SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		i.PROVINCE,
		i.CITY,
		i.COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		i.BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		i.MILKBOX,
		i.VIP_TYPE,
		i.SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.CREATE_AT,
		i.CREATE_BY,
		i.CREATE_BY_TXT,
		i.LAST_MODIFIED,
		i.LAST_MODIFIED_BY,
		i.LAST_MODIFIED_BY_TXT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		i.BRANCH_NO,i.DEALER_NO,
		date_format(FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,date_format(LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME 
		FROM
		t_vip_cust_info i 
		WHERE i.VIP_CUST_NO =#{vipCustNo,jdbcType=VARCHAR}
	</select>
	<select id="findVipCustByNoSapNo" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT
		i.VIP_CUST_NO,
		i.SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		i.PROVINCE,
		i.CITY,
		i.COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		i.BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		i.MILKBOX,
		i.VIP_TYPE,
		i.SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		i.BRANCH_NO,i.DEALER_NO,
		date_format(FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,date_format(LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME 
		FROM
		t_vip_cust_info i 
		WHERE i.SALES_ORG =#{salesOrg,jdbcType=VARCHAR}
		AND (i.VIP_CUST_NO_SAP is null or i.VIP_CUST_NO_SAP = '')
	</select>
	<select id="findVipCustOnlyByNo" resultMap="BaseResultMap" parameterType="java.lang.String">
		SELECT
		i.VIP_CUST_NO,
		i.SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		i.PROVINCE,
		i.CITY,
		i.COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		i.BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		i.MILKBOX,
		i.VIP_TYPE,
		i.SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		i.BRANCH_NO,i.DEALER_NO,
		date_format(FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,date_format(LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME 
		FROM
		t_vip_cust_info i 
		WHERE i.VIP_CUST_NO =#{vipCustNo,jdbcType=VARCHAR}
	</select>
	<insert id="addVipCust" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
		insert into t_vip_cust_info
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="vipCustNo != null">
				VIP_CUST_NO,
			</if>
			<if test="vipCustNoSap != null">
				VIP_CUST_NO_SAP,
			</if>
			<if test="salesOrg != null">
				SALES_ORG,
			</if>
			<if test="vipName != null">
				VIP_NAME,
			</if>
			<if test="addressTxt != null">
				ADDRESS_TXT,
			</if>
			<if test="country != null">
				COUNTRY,
			</if>
			<if test="province != null">
				PROVINCE,
			</if>
			<if test="city != null">
				CITY,
			</if>
			<if test="county != null">
				COUNTY,
			</if>
			<if test="street != null">
				STREET,
			</if>
			<if test="road != null">
				ROAD,
			</if>
			<if test="subdist != null">
				SUBDIST,
			</if>
			<if test="room != null">
				ROOM,
			</if>
			<if test="mp != null">
				MP,
			</if>
			<if test="tel != null">
				TEL,
			</if>
			<if test="zip != null">
				ZIP,
			</if>
			<if test="email != null">
				Email,
			</if>
			<if test="alipayAccount != null">
				ALIPAY_ACCOUNT,
			</if>
			<if test="webchatNo != null">
				WEBCHAT_NO,
			</if>
			<if test="nhEcAccount != null">
				NH_EC_ACCOUNT,
			</if>
			<if test="jdAccount != null">
				JD_ACCOUNT,
			</if>
			<if test="sex != null">
				SEX,
			</if>
			<if test="birthday != null">
				BIRTHDAY,
			</if>
			<if test="certId != null">
				CERT_ID,
			</if>
			<if test="vipSrc != null">
				VIP_SRC,
			</if>
			<if test="milkbox != null">
				MILKBOX,
			</if>
			<if test="vipType != null">
				VIP_TYPE,
			</if>
			<if test="subscribeDate != null">
				SUBSCRIBE_DATE,
			</if>
			<if test="subscriber != null">
				SUBSCRIBER,
			</if>
			<if test="activityNo != null">
				ACTIVITY_NO,
			</if>
			<if test="status != null">
				STATUS,
			</if>
			<if test="vipAmt != null">
				VIP_AMT,
			</if>
			<if test="createAt != null">
				CREATE_AT,
			</if>
			<if test="createBy != null">
				CREATE_BY,
			</if>
			<if test="createByTxt != null">
				CREATE_BY_TXT,
			</if>
			<if test="lastModified != null">
				LAST_MODIFIED,
			</if>
			<if test="lastModifiedBy != null">
				LAST_MODIFIED_BY,
			</if>
			<if test="lastModifiedByTxt != null">
				LAST_MODIFIED_BY_TXT,
			</if>
			<if test="memoTxt != null">
				MEMO_TXT,
			</if>
			<if test="dispMemoTxt != null">
				DISP_MEMO_TXT,
			</if>
			<if test="branchNo != null">
				BRANCH_NO,
			</if>
			<if test="dealerNo != null">
			    DEALER_NO,
			</if>
			<if test="vipMp != null">
				VIP_MP,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="vipCustNo != null">
				#{vipCustNo,jdbcType=VARCHAR},
			</if>
			<if test="vipCustNoSap != null">
				#{vipCustNoSap,jdbcType=VARCHAR},
			</if>
			<if test="salesOrg != null">
				#{salesOrg,jdbcType=VARCHAR},
			</if>
			<if test="vipName != null">
				#{vipName,jdbcType=VARCHAR},
			</if>
			<if test="addressTxt != null">
				#{addressTxt,jdbcType=VARCHAR},
			</if>
			<if test="country != null">
				#{country,jdbcType=VARCHAR},
			</if>
			<if test="province != null">
				#{province,jdbcType=VARCHAR},
			</if>
			<if test="city != null">
				#{city,jdbcType=VARCHAR},
			</if>
			<if test="county != null">
				#{county,jdbcType=VARCHAR},
			</if>
			<if test="street != null">
				#{street,jdbcType=VARCHAR},
			</if>
			<if test="road != null">
				#{road,jdbcType=VARCHAR},
			</if>
			<if test="subdist != null">
				#{subdist,jdbcType=VARCHAR},
			</if>
			<if test="room != null">
				#{room,jdbcType=VARCHAR},
			</if>
			<if test="mp != null">
				#{mp,jdbcType=VARCHAR},
			</if>
			<if test="tel != null">
				#{tel,jdbcType=VARCHAR},
			</if>
			<if test="zip != null">
				#{zip,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				#{email,jdbcType=VARCHAR},
			</if>
			<if test="alipayAccount != null">
				#{alipayAccount,jdbcType=VARCHAR},
			</if>
			<if test="webchatNo != null">
				#{webchatNo,jdbcType=VARCHAR},
			</if>
			<if test="nhEcAccount != null">
				#{nhEcAccount,jdbcType=VARCHAR},
			</if>
			<if test="jdAccount != null">
				#{jdAccount,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				#{sex,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				#{birthday,jdbcType=DATE},
			</if>
			<if test="certId != null">
				#{certId,jdbcType=VARCHAR},
			</if>
			<if test="vipSrc != null">
				#{vipSrc,jdbcType=VARCHAR},
			</if>
			<if test="milkbox != null">
				#{milkbox,jdbcType=VARCHAR},
			</if>
			<if test="vipType != null">
				#{vipType,jdbcType=VARCHAR},
			</if>
			<if test="subscribeDate != null">
				#{subscribeDate,jdbcType=DATE},
			</if>
			<if test="subscriber != null">
				#{subscriber,jdbcType=VARCHAR},
			</if>
			<if test="activityNo != null">
				#{activityNo,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				#{status,jdbcType=VARCHAR},
			</if>
			<if test="vipAmt != null">
				#{vipAmt,jdbcType=DECIMAL},
			</if>
			<if test="createAt != null">
				#{createAt,jdbcType=TIMESTAMP},
			</if>
			<if test="createBy != null">
				#{createBy,jdbcType=VARCHAR},
			</if>
			<if test="createByTxt != null">
				#{createByTxt,jdbcType=VARCHAR},
			</if>
			<if test="lastModified != null">
				#{lastModified,jdbcType=TIMESTAMP},
			</if>
			<if test="lastModifiedBy != null">
				#{lastModifiedBy,jdbcType=VARCHAR},
			</if>
			<if test="lastModifiedByTxt != null">
				#{lastModifiedByTxt,jdbcType=VARCHAR},
			</if>
			<if test="memoTxt != null">
				#{memoTxt,jdbcType=VARCHAR},
			</if>
			<if test="dispMemoTxt != null">
				#{dispMemoTxt,jdbcType=VARCHAR},
			</if>
			<if test="branchNo != null">
				#{branchNo,jdbcType=VARCHAR},
			</if>
			<if test="dealerNo != null">
			    #{dealerNo,jdbcType=VARCHAR},
			</if>
			<if test="vipMp != null">
				#{vipMp,jdbcType=VARCHAR},
			</if>
		</trim>
	</insert>
	<update id="updateVipCustByNo" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
		update t_vip_cust_info
		<set>
			<if test="vipCustNoSap != null">
				VIP_CUST_NO_SAP = #{vipCustNoSap,jdbcType=VARCHAR},
			</if>
			<if test="salesOrg != null">
				SALES_ORG = #{salesOrg,jdbcType=VARCHAR},
			</if>
			<if test="vipName != null">
				VIP_NAME = #{vipName,jdbcType=VARCHAR},
			</if>
			<if test="addressTxt != null">
				ADDRESS_TXT = #{addressTxt,jdbcType=VARCHAR},
			</if>
			<if test="country != null">
				COUNTRY = #{country,jdbcType=VARCHAR},
			</if>
			<if test="province != null">
				PROVINCE = #{province,jdbcType=VARCHAR},
			</if>
			<if test="city != null">
				CITY = #{city,jdbcType=VARCHAR},
			</if>
			<if test="county != null">
				COUNTY = #{county,jdbcType=VARCHAR},
			</if>
			<if test="street != null">
				STREET = #{street,jdbcType=VARCHAR},
			</if>
			<if test="road != null">
				ROAD = #{road,jdbcType=VARCHAR},
			</if>
			<if test="subdist != null">
				SUBDIST = #{subdist,jdbcType=VARCHAR},
			</if>
			<if test="room != null">
				ROOM = #{room,jdbcType=VARCHAR},
			</if>
			<if test="mp != null">
				MP = #{mp,jdbcType=VARCHAR},
			</if>
			<if test="tel != null">
				TEL = #{tel,jdbcType=VARCHAR},
			</if>
			<if test="zip != null">
				ZIP = #{zip,jdbcType=VARCHAR},
			</if>
			<if test="email != null">
				Email = #{email,jdbcType=VARCHAR},
			</if>
			<if test="alipayAccount != null">
				ALIPAY_ACCOUNT = #{alipayAccount,jdbcType=VARCHAR},
			</if>
			<if test="webchatNo != null">
				WEBCHAT_NO = #{webchatNo,jdbcType=VARCHAR},
			</if>
			<if test="nhEcAccount != null">
				NH_EC_ACCOUNT = #{nhEcAccount,jdbcType=VARCHAR},
			</if>
			<if test="jdAccount != null">
				JD_ACCOUNT = #{jdAccount,jdbcType=VARCHAR},
			</if>
			<if test="sex != null">
				SEX = #{sex,jdbcType=VARCHAR},
			</if>
			<if test="birthday != null">
				BIRTHDAY = #{birthday,jdbcType=DATE},
			</if>
			<if test="certId != null">
				CERT_ID = #{certId,jdbcType=VARCHAR},
			</if>
			<if test="vipSrc != null">
				VIP_SRC = #{vipSrc,jdbcType=VARCHAR},
			</if>
			<if test="milkbox != null">
				MILKBOX = #{milkbox,jdbcType=VARCHAR},
			</if>
			<if test="vipType != null">
				VIP_TYPE = #{vipType,jdbcType=VARCHAR},
			</if>
			<if test="subscribeDate != null">
				SUBSCRIBE_DATE = #{subscribeDate,jdbcType=DATE},
			</if>
			<if test="subscriber != null">
				SUBSCRIBER = #{subscriber,jdbcType=VARCHAR},
			</if>
			<if test="activityNo != null">
				ACTIVITY_NO = #{activityNo,jdbcType=VARCHAR},
			</if>
			<if test="status != null">
				STATUS = #{status,jdbcType=VARCHAR},
			</if>
			<if test="vipAmt != null">
				VIP_AMT = #{vipAmt,jdbcType=DECIMAL},
			</if>
			<if test="createAt != null">
				CREATE_AT = #{createAt,jdbcType=TIMESTAMP},
			</if>
			<if test="createBy != null">
				CREATE_BY = #{createBy,jdbcType=VARCHAR},
			</if>
			<if test="createByTxt != null">
				CREATE_BY_TXT = #{createByTxt,jdbcType=VARCHAR},
			</if>
			<if test="lastModified != null">
				LAST_MODIFIED = #{lastModified,jdbcType=TIMESTAMP},
			</if>
			<if test="lastModifiedBy != null">
				LAST_MODIFIED_BY = #{lastModifiedBy,jdbcType=VARCHAR},
			</if>
			<if test="lastModifiedByTxt != null">
				LAST_MODIFIED_BY_TXT =
				#{lastModifiedByTxt,jdbcType=VARCHAR},
			</if>
			<if test="memoTxt != null">
				MEMO_TXT = #{memoTxt,jdbcType=VARCHAR},
			</if>
			<if test="dispMemoTxt != null">
				DISP_MEMO_TXT = #{dispMemoTxt,jdbcType=VARCHAR},
			</if>
			<if test="branchNo != null">
				BRANCH_NO = #{branchNo,jdbcType=VARCHAR},
			</if>
			<if test="vipMp != null">
				VIP_MP = #{vipMp,jdbcType=VARCHAR},
			</if>
		</set>
		where VIP_CUST_NO = #{vipCustNo,jdbcType=VARCHAR}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
		update
		t_vip_cust_info
		set VIP_CUST_NO_SAP = #{vipCustNoSap,jdbcType=VARCHAR},
		SALES_ORG = #{salesOrg,jdbcType=VARCHAR},
		VIP_NAME =
		#{vipName,jdbcType=VARCHAR},
		ADDRESS_TXT =
		#{addressTxt,jdbcType=VARCHAR},
		COUNTRY = #{country,jdbcType=VARCHAR},
		PROVINCE = #{province,jdbcType=VARCHAR},
		CITY =
		#{city,jdbcType=VARCHAR},
		COUNTY = #{county,jdbcType=VARCHAR},
		STREET =
		#{street,jdbcType=VARCHAR},
		ROAD = #{road,jdbcType=VARCHAR},
		SUBDIST =
		#{subdist,jdbcType=VARCHAR},
		ROOM = #{room,jdbcType=VARCHAR},
		MP =
		#{mp,jdbcType=VARCHAR},
		TEL = #{tel,jdbcType=VARCHAR},
		ZIP =
		#{zip,jdbcType=VARCHAR},
		Email = #{email,jdbcType=VARCHAR},
		ALIPAY_ACCOUNT = #{alipayAccount,jdbcType=VARCHAR},
		WEBCHAT_NO =
		#{webchatNo,jdbcType=VARCHAR},
		NH_EC_ACCOUNT =
		#{nhEcAccount,jdbcType=VARCHAR},
		JD_ACCOUNT =
		#{jdAccount,jdbcType=VARCHAR},
		SEX = #{sex,jdbcType=VARCHAR},
		BIRTHDAY =
		#{birthday,jdbcType=DATE},
		CERT_ID = #{certId,jdbcType=VARCHAR},
		VIP_SRC = #{vipSrc,jdbcType=VARCHAR},
		MILKBOX =
		#{milkbox,jdbcType=VARCHAR},
		VIP_TYPE = #{vipType,jdbcType=VARCHAR},
		SUBSCRIBE_DATE = #{subscribeDate,jdbcType=DATE},
		SUBSCRIBER =
		#{subscriber,jdbcType=VARCHAR},
		ACTIVITY_NO =
		#{activityNo,jdbcType=VARCHAR},
		STATUS = #{status,jdbcType=VARCHAR},
		VIP_AMT = #{vipAmt,jdbcType=DECIMAL},
		CREATE_AT =
		#{createAt,jdbcType=TIMESTAMP},
		CREATE_BY =
		#{createBy,jdbcType=VARCHAR},
		CREATE_BY_TXT =
		#{createByTxt,jdbcType=VARCHAR},
		LAST_MODIFIED =
		#{lastModified,jdbcType=TIMESTAMP},
		LAST_MODIFIED_BY =
		#{lastModifiedBy,jdbcType=VARCHAR},
		LAST_MODIFIED_BY_TXT =
		#{lastModifiedByTxt,jdbcType=VARCHAR},
		MEMO_TXT =
		#{memoTxt,jdbcType=VARCHAR},
		DISP_MEMO_TXT =
		#{dispMemoTxt,jdbcType=VARCHAR},
		BRANCH_NO =
		#{branchNo,jdbcType=VARCHAR},
		VIP_MP = #{vipMp,jdbcType=VARCHAR}
		where VIP_CUST_NO =
		#{vipCustNo,jdbcType=VARCHAR}
	</update>
	<select id="findStaCustByPhone" resultMap="BaseResultMap" parameterType="java.util.Map">
		select <include refid="Base_Column_List" /> from t_vip_cust_info where MP = #{phone} and BRANCH_NO=#{branchNo}
	</select>
	<select id="findCompanyCustByPhone" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from t_vip_cust_info 
		<where>
		    <if test="phone != null and phone != ''">
		        MP = #{phone} 
		    </if>
		    <if test="salesOrg != null and salesOrg != ''">
		        and SALES_ORG=#{salesOrg}
		    </if>
		</where>
	</select>
	<select id="findVipCust" resultMap="BaseResultMap"
		parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from t_vip_cust_info where MP = #{phone} and SALES_ORG=#{salesOrg}
	</select>
	<update id="uptCustStatus" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
	   update t_vip_cust_info
		<set>
			<if test="status != null and status != ''">
				STATUS = #{status,jdbcType=VARCHAR},
			</if>
			<if test="lastModified != null">
				LAST_MODIFIED = #{lastModified,jdbcType=TIMESTAMP},
			</if>
			<if test="lastModifiedBy != null">
				LAST_MODIFIED_BY = #{lastModifiedBy,jdbcType=VARCHAR},
			</if>
			<if test="lastModifiedByTxt != null">
				LAST_MODIFIED_BY_TXT =
				#{lastModifiedByTxt,jdbcType=VARCHAR},
			</if>
			<if test="firstOrderTime != null">
				FIRST_ORDER_TIME = #{firstOrderTime,jdbcType=TIMESTAMP},
			</if>
			<if test="lastOrderTime != null">
				LAST_ORDER_TIME = #{lastOrderTime,jdbcType=TIMESTAMP},
			</if>
		</set>
		where VIP_CUST_NO = #{vipCustNo,jdbcType=VARCHAR}
	</update>
	<select id="findcustMixedTerms" resultMap="BaseResultMap" parameterType="com.nhry.model.basic.CustQueryModel">
		 select (SELECT a.ACCT_AMT from t_vip_acct a WHERE i.VIP_CUST_NO = a.VIP_CUST_NO) ACCT_AMT ,i.VIP_CUST_NO,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.SALES_ORG_CONSTANT" /> AND 
		it.ITEM_CODE = i.SALES_ORG
		) SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.PROVINCE
		) PROVINCE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.CITY
		) CITY,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND 
		it.ITEM_CODE = i.COUNTY
		) COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		a.RESIDENTIAL_AREA_TXT SUBDIST_NAME,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		date_format(i.BIRTHDAY, '%Y-%m-%d') BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_src" /> AND 
		it.ITEM_CODE = i.VIP_SRC
		) VIP_SRC_NAME,
		i.MILKBOX,
		i.VIP_TYPE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_type" /> AND 
		it.ITEM_CODE = i.VIP_TYPE
		) VIP_TYPE_NAME, 
		date_format(i.SUBSCRIBE_DATE, '%Y-%m-%d') SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.CREATE_AT,
		i.CREATE_BY,
		date_format(i.FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,
		date_format(i.LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME,
		i.CREATE_BY_TXT,
		i.LAST_MODIFIED,
		i.LAST_MODIFIED_BY,
		i.LAST_MODIFIED_BY_TXT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		b.BRANCH_NAME,i.BRANCH_NO,i.DEALER_NO,
		(
			SELECT
				t.ORG_CODE
			FROM t_md_org_cust oc
			LEFT  JOIN t_md_order_org t on oc.ORG_ID = t.ID
			WHERE oc.CUST_ID = i.VIP_CUST_NO
		)
		ORG_ID,
		(
			SELECT
				og.ORG_NAME
			FROM t_md_org_cust oc
			LEFT JOIN t_md_order_org og on oc.ORG_ID = og.ID
			WHERE oc.CUST_ID = i.VIP_CUST_NO
		)
		ORG_NAME,
		(CASE i.DEALER_NO
			WHEN '-1' THEN '<include refid="mybaties.constant.ownBranch"></include>'
			ELSE (SELECT d.dealer_name from t_md_dealer d where d.dealer_no=i.DEALER_NO) END) DEALER_NAME
		from t_vip_cust_info i
		LEFT JOIN t_md_branch b ON b.BRANCH_NO = i.BRANCH_NO
		LEFT JOIN t_md_residential_area a ON a.ID=i.SUBDIST
			where 1=1
		     <if test="salesOrg != null and salesOrg !=''">
		         AND i.SALES_ORG = #{salesOrg} 
		     </if>
		    <choose>
		         <when test="stationType != null and stationType != '' ">
		            <choose>
		                <when test="stationType=='02'">
		                	   <!-- 经销商奶站 -->
					           <choose>
								   <when test="(dealerNo != null and dealerNo != '') and (station != null and station != '') ">
									   and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo} and i.BRANCH_NO = #{station}
								   </when>
					               <when test="(dealerNo != null and dealerNo != '') and (station == null or station == '') ">
										and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo}
					               </when>
								   <when test="(dealerNo == null or dealerNo == '') and (station != null and station != '') ">
									   and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{station}
								   </when>
					               <otherwise>
					               		and b.BRANCH_GROUP=#{stationType} 
					               </otherwise>
					           </choose>
		                </when>
		                <otherwise>
		                     <choose>
					               <when test="station != null and station != ''">
					               		and b.BRANCH_GROUP=#{stationType} and i.BRANCH_NO = #{station} 
					               </when>
					               <otherwise>
					               		and b.BRANCH_GROUP=#{stationType} 	
					               </otherwise>
					           </choose>
		                </otherwise>
		            </choose>
		         </when>
		         <otherwise>
		         <!-- 自有奶站 -->
		             <if test="station != null and station != ''">
				    	 and i.BRANCH_NO = #{station} 
				    </if>
		         </otherwise>
		     </choose>
		    <if test="status != null and status != ''">
		    	and i.STATUS = #{status} 
		    </if>
		    <if test="startDate != null and startDate != ''">
		    	and i.SUBSCRIBE_DATE &gt;= #{startDate} 
		    </if>
		    <if test="endDate != null and endDate != ''">
		    	and i.SUBSCRIBE_DATE &lt;= #{endDate} 
		    </if>
		    <if test="content != null and content != ''">
		        and (i.VIP_NAME like '%${content}%' or i.ADDRESS_TXT like '%${content}%' or i.MP like '%${content}%' or 
		        a.RESIDENTIAL_AREA_TXT like '%${content}%' or concat(a.RESIDENTIAL_AREA_TXT,i.ADDRESS_TXT) like '%${content}%')
		    </if>
		    <if test="phone != null and phone != ''">
		       and i.MP = #{phone}
		    </if>
		order by i.CREATE_AT desc,i.LAST_MODIFIED desc,i.BRANCH_NO,i.DEALER_NO
	</select>
	<select id="findCustByOrgId" resultMap="BaseResultMap" parameterType="com.nhry.model.basic.CustQueryModel">
	select (SELECT a.ACCT_AMT from t_vip_acct a WHERE i.VIP_CUST_NO = a.VIP_CUST_NO) ACCT_AMT ,i.VIP_CUST_NO,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.SALES_ORG_CONSTANT" /> AND
	it.ITEM_CODE = i.SALES_ORG
	) SALES_ORG,
	i.VIP_NAME,
	i.ADDRESS_TXT,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
	it.ITEM_CODE = i.PROVINCE
	) PROVINCE,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
	it.ITEM_CODE = i.CITY
	) CITY,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
	it.ITEM_CODE = i.COUNTY
	) COUNTY,
	i.STREET,
	i.ROAD,
	i.SUBDIST,
	a.RESIDENTIAL_AREA_TXT SUBDIST_NAME,
	i.ROOM,
	i.MP,
	i.VIP_MP,
	i.ZIP,
	i.Email,
	i.SEX,
	date_format(i.BIRTHDAY, '%Y-%m-%d') BIRTHDAY,
	i.CERT_ID,
	i.VIP_SRC,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_src" /> AND
	it.ITEM_CODE = i.VIP_SRC
	) VIP_SRC_NAME,
	i.MILKBOX,
	i.VIP_TYPE,
	(
	SELECT
	it.ITEM_NAME
	FROM
	T_SYS_CODE_ITEM it
	WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_type" /> AND
	it.ITEM_CODE = i.VIP_TYPE
	) VIP_TYPE_NAME,
	date_format(i.SUBSCRIBE_DATE, '%Y-%m-%d') SUBSCRIBE_DATE,
	i.SUBSCRIBER,
	i.ACTIVITY_NO,
	i. STATUS,
	i.VIP_AMT,
	i.CREATE_AT,
	i.CREATE_BY,
	date_format(i.FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,
	date_format(i.LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME,
	i.CREATE_BY_TXT,
	i.LAST_MODIFIED,
	i.LAST_MODIFIED_BY,
	i.LAST_MODIFIED_BY_TXT,
	i.MEMO_TXT,
	i.DISP_MEMO_TXT,
	b.BRANCH_NAME,i.BRANCH_NO,i.DEALER_NO,(CASE i.DEALER_NO
	WHEN '-1' THEN '<include refid="mybaties.constant.ownBranch"></include>'
	ELSE (SELECT d.dealer_name from t_md_dealer d where d.dealer_no=i.DEALER_NO) END) DEALER_NAME
	from t_vip_cust_info i
	INNER JOIN t_md_org_cust oct on oct.CUST_ID = i.VIP_CUST_NO and oct.ORG_ID = #{orgId,jdbcType=VARCHAR}
	LEFT JOIN t_md_branch b ON b.BRANCH_NO = i.BRANCH_NO
	LEFT JOIN t_md_residential_area a ON a.ID=i.SUBDIST
	where 1=1
	<if test="salesOrg != null and salesOrg !=''">
		AND i.SALES_ORG = #{salesOrg}
	</if>
	<choose>
		<when test="stationType != null and stationType != '' ">
			<choose>
				<when test="stationType=='02'">
					<!-- 经销商奶站 -->
					<choose>
						<when test="(dealerNo != null and dealerNo != '') and (station != null and station != '') ">
							and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo} and i.BRANCH_NO = #{station}
						</when>
						<when test="(dealerNo != null and dealerNo != '') and (station == null or station == '') ">
							and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo}
						</when>
						<otherwise>
							and b.BRANCH_GROUP=#{stationType}
						</otherwise>
					</choose>
				</when>
				<otherwise>
					<choose>
						<when test="station != null and station != ''">
							and b.BRANCH_GROUP=#{stationType} and i.BRANCH_NO = #{station}
						</when>
						<otherwise>
							and b.BRANCH_GROUP=#{stationType}
						</otherwise>
					</choose>
				</otherwise>
			</choose>
		</when>
		<otherwise>
			<!-- 自有奶站 -->
			<if test="station != null and station != ''">
				and i.BRANCH_NO = #{station}
			</if>
		</otherwise>
	</choose>
	<if test="status != null and status != ''">
		and i.STATUS = #{status}
	</if>
	<if test="startDate != null and startDate != ''">
		and i.SUBSCRIBE_DATE &gt;= #{startDate}
	</if>
	<if test="endDate != null and endDate != ''">
		and i.SUBSCRIBE_DATE &lt;= #{endDate}
	</if>
	<if test="content != null and content != ''">
		and (i.VIP_NAME like '%${content}%' or i.ADDRESS_TXT like '%${content}%' or i.MP like '%${content}%' or
		a.RESIDENTIAL_AREA_TXT like '%${content}%' or concat(a.RESIDENTIAL_AREA_TXT,i.ADDRESS_TXT) like '%${content}%')
	</if>
	<if test="phone != null and phone != ''">
		and i.MP = #{phone}
	</if>
	order by i.CREATE_AT desc,i.LAST_MODIFIED desc,i.BRANCH_NO,i.DEALER_NO
	</select>

	<select id="findcustMixedTermsCount"  resultType="Long"  parameterType="com.nhry.model.basic.CustQueryModel">
		 select count(i.VIP_CUST_NO)  from t_vip_cust_info i,t_md_branch b
			where b.BRANCH_NO = i.BRANCH_NO 
		     <if test="salesOrg != null and salesOrg !=''">
		         AND i.SALES_ORG = #{salesOrg} 
		     </if>
		    <choose>
		         <when test="stationType != null and stationType != '' ">
		            <choose>
		                <when test="stationType=='02'">
		                	   <!-- 经销商奶站 -->
					           <choose>
								   <when test="(dealerNo != null and dealerNo != '') and (station != null and station != '') ">
									   and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo} and i.BRANCH_NO = #{station}
								   </when>
					               <when test="(dealerNo != null and dealerNo != '') and (station == null or station == '') ">
										and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo}
					               </when>
								   <when test="(dealerNo == null or dealerNo == '') and (station != null and station != '') ">
									   and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{station}
								   </when>
					               <otherwise>
					               		and b.BRANCH_GROUP=#{stationType} 
					               </otherwise>
					           </choose>
		                </when>
		                <otherwise>
		                     <choose>
					               <when test="station != null and station != ''">
					               		and b.BRANCH_GROUP=#{stationType} and i.BRANCH_NO = #{station} 
					               </when>
					               <otherwise>
					               		and b.BRANCH_GROUP=#{stationType} 	
					               </otherwise>
					           </choose>
		                </otherwise>
		            </choose>
		         </when>
		         <otherwise>
		         <!-- 自有奶站 -->
		             <if test="station != null and station != ''">
				    	 and i.BRANCH_NO = #{station} 
				    </if>
		         </otherwise>
		     </choose>
		    <if test="status != null and status != ''">
		    	and i.STATUS = #{status} 
		    </if>
		    <if test="startDate != null and startDate != ''">
		    	and i.SUBSCRIBE_DATE &gt;= #{startDate} 
		    </if>
		    <if test="endDate != null and endDate != ''">
		    	and i.SUBSCRIBE_DATE &lt;= #{endDate} 
		    </if>
		    <if test="content != null and content != ''">
		        and (i.VIP_NAME like '%${content}%' or i.ADDRESS_TXT like '%${content}%' or i.MP like '%${content}%' or 
		        (select a.RESIDENTIAL_AREA_TXT from t_md_residential_area a where a.ID=IFNULL(i.SUBDIST,'-1')) like '%${content}%') 
		    </if>
		    <if test="phone != null and phone != ''">
		       and i.MP = #{phone}
		    </if>
	</select>
	<select id="getCustCountByPhone"  resultType="Integer" parameterType="java.util.HashMap">
	   SELECT count(c.VIP_CUST_NO) from t_vip_cust_info c 
	   <where>
	        <if test="custNo != null and custNo != ''">
	        	c.VIP_CUST_NO &lt;&gt; #{custNo} 
	        </if>
	        <if test="phone != null and phone != ''">
	        	AND c.MP= #{phone}
	        </if>
	        <if test="salesOrg != null and salesOrg != ''">
	        	and c.SALES_ORG=#{salesOrg}
	        </if>
	        <if test="branchNo != null and branchNo != ''">
	        	and c.BRANCH_NO=#{branchNo}
	        </if>
	   </where>
	</select>
	<select id="getCustNoByPhone"  resultType="String" parameterType="java.util.HashMap">
	   SELECT c.VIP_CUST_NO from t_vip_cust_info c 
	   <where>
	        <if test="custNo != null and custNo != ''">
	        	c.VIP_CUST_NO &lt;&gt; #{custNo} 
	        </if>
	        <if test="phone != null and phone != ''">
	        	AND c.MP= #{phone}
	        </if>
	        <if test="salesOrg != null and salesOrg != ''">
	        	and c.SALES_ORG=#{salesOrg}
	        </if>
	        <if test="branchNo != null and branchNo != ''">
	        	and c.BRANCH_NO=#{branchNo}
	        </if>
	   </where>
	</select>
	<delete id="deleteCustByCno" parameterType="String">
	    delete from t_vip_cust_info where VIP_CUST_NO=#{cno}
	</delete>
	<select id="getCustInfoStat" resultType="com.nhry.model.basic.CustStat" parameterType="java.util.HashMap">
	   SELECT
			i. STATUS,
			count(i. STATUS) amount 
		FROM
			t_vip_cust_info i
		<where>
		   <if test="salesOrg != null and salesOrg != ''">
		   		i.SALES_ORG = #{salesOrg}
		   </if>
		   <if test="dealerNo != null and dealerNo != ''">
		   		AND i.DEALER_NO = #{dealerNo}
		   </if>
		   <if test="branchNo != null and branchNo != ''">
		   		AND i.BRANCH_NO = #{branchNo}
		   </if>
		   AND i.STATUS IS NOT NULL
		</where>
		GROUP BY
			i. STATUS
	</select>
	<select id="updateSapNo" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
		UPDATE t_vip_cust_info set VIP_CUST_NO_SAP=#{vipCustNoSap},VIP_MP=#{vipMp} WHERE VIP_CUST_NO = #{vipCustNo}
	</select>

	<update id="updateVipMp" parameterType="com.nhry.data.basic.domain.TVipCustInfo">
		UPDATE t_vip_cust_info set VIP_MP=#{vipMp} WHERE VIP_CUST_NO_SAP=#{vipCustNoSap}
	</update>


	<select id="findCustByOrg" resultMap="BaseResultMap" parameterType="com.nhry.model.basic.CustQueryModel">
		select (SELECT a.ACCT_AMT from t_vip_acct a WHERE i.VIP_CUST_NO = a.VIP_CUST_NO) ACCT_AMT ,i.VIP_CUST_NO,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.SALES_ORG_CONSTANT" /> AND
		it.ITEM_CODE = i.SALES_ORG
		) SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.PROVINCE
		) PROVINCE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.CITY
		) CITY,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.COUNTY
		) COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		a.RESIDENTIAL_AREA_TXT SUBDIST_NAME,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		date_format(i.BIRTHDAY, '%Y-%m-%d') BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_src" /> AND
		it.ITEM_CODE = i.VIP_SRC
		) VIP_SRC_NAME,
		i.MILKBOX,
		i.VIP_TYPE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_type" /> AND
		it.ITEM_CODE = i.VIP_TYPE
		) VIP_TYPE_NAME,
		date_format(i.SUBSCRIBE_DATE, '%Y-%m-%d') SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.CREATE_AT,
		i.CREATE_BY,
		date_format(i.FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,
		date_format(i.LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME,
		i.CREATE_BY_TXT,
		i.LAST_MODIFIED,
		i.LAST_MODIFIED_BY,
		i.LAST_MODIFIED_BY_TXT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		b.BRANCH_NAME,i.BRANCH_NO,i.DEALER_NO,
		t.ORG_CODE ORG_ID,
		t.ORG_NAME,
		(CASE i.DEALER_NO
		WHEN '-1' THEN '<include refid="mybaties.constant.ownBranch"></include>'
		ELSE (SELECT d.dealer_name from t_md_dealer d where d.dealer_no=i.DEALER_NO) END) DEALER_NAME
		from t_md_org_cust oc
		LEFT JOIN t_md_order_org t on oc.ORG_ID = t.ID
		LEFT JOIN t_vip_cust_info i on oc.CUST_ID = i.VIP_CUST_NO
		LEFT JOIN t_md_branch b ON b.BRANCH_NO = i.BRANCH_NO
		LEFT JOIN t_md_residential_area a ON a.ID=i.SUBDIST
		where 1=1
		<if test="orgId != null and orgId !=''">
			AND oc.ORG_ID = #{orgId,jdbcType=VARCHAR}
		</if>
		<if test="salesOrg != null and salesOrg !=''">
			AND i.SALES_ORG = #{salesOrg}
		</if>
		<choose>
			<when test="stationType != null and stationType != '' ">
				<choose>
					<when test="stationType=='02'">
						<!-- 经销商奶站 -->
						<choose>
							<when test="(dealerNo != null and dealerNo != '') and (station != null and station != '') ">
								and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo} and i.BRANCH_NO = #{station}
							</when>
							<when test="(dealerNo != null and dealerNo != '') and (station == null or station == '') ">
								and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo}
							</when>
							<otherwise>
								and b.BRANCH_GROUP=#{stationType}
							</otherwise>
						</choose>
					</when>
					<otherwise>
						<choose>
							<when test="station != null and station != ''">
								and b.BRANCH_GROUP=#{stationType} and i.BRANCH_NO = #{station}
							</when>
							<otherwise>
								and b.BRANCH_GROUP=#{stationType}
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</when>
			<otherwise>
				<!-- 自有奶站 -->
				<if test="station != null and station != ''">
					and i.BRANCH_NO = #{station}
				</if>
			</otherwise>
		</choose>
		<if test="status != null and status != ''">
			and i.STATUS = #{status}
		</if>
		<if test="startDate != null and startDate != ''">
			and i.SUBSCRIBE_DATE &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
			and i.SUBSCRIBE_DATE &lt;= #{endDate}
		</if>
		<if test="content != null and content != ''">
			and (i.VIP_NAME like '%${content}%' or i.ADDRESS_TXT like '%${content}%' or i.MP like '%${content}%' or
			a.RESIDENTIAL_AREA_TXT like '%${content}%' or concat(a.RESIDENTIAL_AREA_TXT,i.ADDRESS_TXT) like '%${content}%')
		</if>
		<if test="phone != null and phone != ''">
			and i.MP = #{phone}
		</if>
		order by i.CREATE_AT desc,i.LAST_MODIFIED desc,i.BRANCH_NO,i.DEALER_NO
	</select>


	<select id="findCustWithoutOrg" resultMap="BaseResultMap" parameterType="com.nhry.model.basic.CustQueryModel">
		select (SELECT a.ACCT_AMT from t_vip_acct a WHERE i.VIP_CUST_NO = a.VIP_CUST_NO) ACCT_AMT ,i.VIP_CUST_NO,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.SALES_ORG_CONSTANT" /> AND
		it.ITEM_CODE = i.SALES_ORG
		) SALES_ORG,
		i.VIP_NAME,
		i.ADDRESS_TXT,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.PROVINCE
		) PROVINCE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.CITY
		) CITY,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.COUNTRY_CITY_CONSTANT" /> AND
		it.ITEM_CODE = i.COUNTY
		) COUNTY,
		i.STREET,
		i.ROAD,
		i.SUBDIST,
		a.RESIDENTIAL_AREA_TXT SUBDIST_NAME,
		i.ROOM,
		i.MP,
		i.VIP_MP,
		i.ZIP,
		i.Email,
		i.SEX,
		date_format(i.BIRTHDAY, '%Y-%m-%d') BIRTHDAY,
		i.CERT_ID,
		i.VIP_SRC,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_src" /> AND
		it.ITEM_CODE = i.VIP_SRC
		) VIP_SRC_NAME,
		i.MILKBOX,
		i.VIP_TYPE,
		(
		SELECT
		it.ITEM_NAME
		FROM
		T_SYS_CODE_ITEM it
		WHERE it.TYPE_CODE = <include refid="mybaties.constant.vip_type" /> AND
		it.ITEM_CODE = i.VIP_TYPE
		) VIP_TYPE_NAME,
		date_format(i.SUBSCRIBE_DATE, '%Y-%m-%d') SUBSCRIBE_DATE,
		i.SUBSCRIBER,
		i.ACTIVITY_NO,
		i. STATUS,
		i.VIP_AMT,
		i.CREATE_AT,
		i.CREATE_BY,
		date_format(i.FIRST_ORDER_TIME, '%Y-%m-%d') FIRST_ORDER_TIME,
		date_format(i.LAST_ORDER_TIME, '%Y-%m-%d') LAST_ORDER_TIME,
		i.CREATE_BY_TXT,
		i.LAST_MODIFIED,
		i.LAST_MODIFIED_BY,
		i.LAST_MODIFIED_BY_TXT,
		i.MEMO_TXT,
		i.DISP_MEMO_TXT,
		b.BRANCH_NAME,i.BRANCH_NO,i.DEALER_NO,
		(CASE i.DEALER_NO
		WHEN '-1' THEN '<include refid="mybaties.constant.ownBranch"></include>'
		ELSE (SELECT d.dealer_name from t_md_dealer d where d.dealer_no=i.DEALER_NO) END) DEALER_NAME
		from t_vip_cust_info i
		LEFT JOIN t_md_org_cust c on i.VIP_CUST_NO = c.CUST_ID
		LEFT JOIN t_md_branch b ON b.BRANCH_NO = i.BRANCH_NO
		LEFT JOIN t_md_residential_area a ON a.ID=i.SUBDIST
		where 1=1
		and (c.ORG_ID is null  OR c.ORG_ID='')
		<if test="salesOrg != null and salesOrg !=''">
			AND i.SALES_ORG = #{salesOrg}
		</if>
		<choose>
			<when test="stationType != null and stationType != '' ">
				<choose>
					<when test="stationType=='02'">
						<!-- 经销商奶站 -->
						<choose>
							<when test="(dealerNo != null and dealerNo != '') and (station != null and station != '') ">
								and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo} and i.BRANCH_NO = #{station}
							</when>
							<when test="(dealerNo != null and dealerNo != '') and (station == null or station == '') ">
								and b.BRANCH_GROUP=#{stationType} and i.DEALER_NO = #{dealerNo}
							</when>
							<otherwise>
								and b.BRANCH_GROUP=#{stationType}
							</otherwise>
						</choose>
					</when>
					<otherwise>
						<choose>
							<when test="station != null and station != ''">
								and b.BRANCH_GROUP=#{stationType} and i.BRANCH_NO = #{station}
							</when>
							<otherwise>
								and b.BRANCH_GROUP=#{stationType}
							</otherwise>
						</choose>
					</otherwise>
				</choose>
			</when>
			<otherwise>
				<!-- 自有奶站 -->
				<if test="station != null and station != ''">
					and i.BRANCH_NO = #{station}
				</if>
			</otherwise>
		</choose>
		<if test="status != null and status != ''">
			and i.STATUS = #{status}
		</if>
		<if test="startDate != null and startDate != ''">
			and i.SUBSCRIBE_DATE &gt;= #{startDate}
		</if>
		<if test="endDate != null and endDate != ''">
			and i.SUBSCRIBE_DATE &lt;= #{endDate}
		</if>
		<if test="content != null and content != ''">
			and (i.VIP_NAME like '%${content}%' or i.ADDRESS_TXT like '%${content}%' or i.MP like '%${content}%' or
			a.RESIDENTIAL_AREA_TXT like '%${content}%' or concat(a.RESIDENTIAL_AREA_TXT,i.ADDRESS_TXT) like '%${content}%')
		</if>
		<if test="phone != null and phone != ''">
			and i.MP = #{phone}
		</if>
		order by i.CREATE_AT desc,i.LAST_MODIFIED desc,i.BRANCH_NO,i.DEALER_NO
	</select>
</mapper>